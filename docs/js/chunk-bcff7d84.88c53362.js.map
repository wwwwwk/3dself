{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es.string.sub.js","webpack:///./node_modules/core-js/internals/create-html.js","webpack:///./src/views/gongfang.vue?3feb","webpack:///./node_modules/core-js/internals/string-html-forced.js","webpack:///./src/assets/city/water.jpg","webpack:///./src/views/gongfang.vue?3906","webpack:///./src/components/GongfangPage/bigmask.ts","webpack:///./src/components/GongfangPage/smallmask.ts","webpack:///./src/components/GongfangPage/glrender.ts","webpack:///./src/components/GongfangPage/index.vue","webpack:///./src/components/GongfangPage/index.vue?a67f","webpack:///./src/views/gongfang.vue","webpack:///./src/views/gongfang.vue?9f0a","webpack:///./src/components/GongfangPage/index.vue?9ffd"],"names":["$","createHTML","forcedStringHTMLMethod","target","proto","forced","sub","this","uncurryThis","requireObjectCoercible","toString","quot","replace","module","exports","string","tag","attribute","value","S","p1","fails","METHOD_NAME","test","toLowerCase","split","length","_hoisted_1","class","render","_ctx","_cache","$props","$setup","$data","$options","_component_GongfangPage","attackHandle","flyLine","tweenMove","requestAnimationId","gongfang","ambientLight","hemisLight","baseThree","composer","animateFrame","vs","fs","geometry","Math","PI","canvas","setTexture","texture","material","vertexShader","fragmentShader","uniforms","sphereTexture","spherePos1","type","Array","fill","ring","transparent","side","position","set","layers","enable","document","createElement","width","height","gl","getContext","lingrad","createLinearGradient","addColorStop","fillStyle","fillRect","startAttack","scene","clearInterval","setInterval","removeLine","result","lines","colorData","undefined","i","tmp","push","end","x","y","z","lineData","start","setParticles","particles","add","moveAction","time","updateMaterial","destroy","point1","floor","random","point2","vec","normalize","ray","intersectPoint","intersectSphere","startLocation","endLocation","duration","updateAction","to","easing","Linear","None","onUpdate","onStop","onComplete","repeat","Infinity","animate","update","requestAnimationFrame","bigMaskdestroy","cancelAnimationFrame","remove","dispose","sphereVs","sphereFs","png","load","pointPos","startSmallAttack","smallMaskdestroy","domContainer","camera","setCameraPosition","renderer","orbitControl","mesh","bigMask","smallMask","setup","__props","setCurrentSceneState","gongfangContainer","rotateBtn","isChecked","startRotate","ref_key","ref","__exports__","name","components","GongfangPage","setToolbarState","routeControl","rotateControl","initControl"],"mappings":"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","file":"js/chunk-bcff7d84.88c53362.js","sourcesContent":["'use strict';\nvar $ = require('../internals/export');\nvar createHTML = require('../internals/create-html');\nvar forcedStringHTMLMethod = require('../internals/string-html-forced');\n\n// `String.prototype.sub` method\n// https://tc39.es/ecma262/#sec-string.prototype.sub\n$({ target: 'String', proto: true, forced: forcedStringHTMLMethod('sub') }, {\n  sub: function sub() {\n    return createHTML(this, 'sub', '', '');\n  }\n});\n","var uncurryThis = require('../internals/function-uncurry-this');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar toString = require('../internals/to-string');\n\nvar quot = /\"/g;\nvar replace = uncurryThis(''.replace);\n\n// `CreateHTML` abstract operation\n// https://tc39.es/ecma262/#sec-createhtml\nmodule.exports = function (string, tag, attribute, value) {\n  var S = toString(requireObjectCoercible(string));\n  var p1 = '<' + tag;\n  if (attribute !== '') p1 += ' ' + attribute + '=\"' + replace(toString(value), quot, '&quot;') + '\"';\n  return p1 + '>' + S + '</' + tag + '>';\n};\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./gongfang.vue?vue&type=style&index=0&id=3ce43c52&lang=less\"","var fails = require('../internals/fails');\n\n// check the existence of a method, lowercase\n// of a tag and escaping quotes in arguments\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    var test = ''[METHOD_NAME]('\"');\n    return test !== test.toLowerCase() || test.split('\"').length > 3;\n  });\n};\n","module.exports = __webpack_public_path__ + \"img/water.9ba47ff7.jpg\";","import { resolveComponent as _resolveComponent, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = { class: \"gongfang-main\" }\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_GongfangPage = _resolveComponent(\"GongfangPage\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createVNode(_component_GongfangPage)\n  ]))\n}","import * as THREE from \"three\";\r\nimport { Easing, Tween } from \"@tweenjs/tween.js\";\r\n\r\nimport { bloomLayerNum } from \"@/utils/setbloom\";\r\nimport { FlyLine } from \"@/components/Earth/line\";\r\n\r\nconst vs = `\r\n  varying vec2 vUv;\r\n  varying vec3 vPosition;\r\n  void main() {\r\n    vUv = uv;\r\n    vPosition = position;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n  }\r\n`;\r\n\r\nconst fs = `\r\n  uniform sampler2D sphereTexture;\r\n  uniform vec3 spherePos1[10];\r\n  varying vec2 vUv;\r\n  varying vec3 vPosition;\r\n  uniform float ring;\r\n  void main() {\r\n    vec4 finalColor = vec4(-1.0, -1.0, -1.0, -1.0);\r\n    for(int i=0; i<10; i++) {\r\n      if(spherePos1[i].x == -1.0 && spherePos1[i].y == -1.0 && spherePos1[i].z == -1.0) {\r\n        vec4 color = vec4(texture2D(sphereTexture, vUv));\r\n        finalColor = vec4(color.xyz, 0.2);\r\n      } else {\r\n        float dis = distance(vPosition, spherePos1[i]);\r\n        if(dis > ring && dis < (2.0)) {\r\n          gl_FragColor = vec4(0.0,1.0,0.0, 0.3);\r\n          return;\r\n        } else {\r\n          vec4 color = vec4(texture2D(sphereTexture, vUv));\r\n          finalColor = vec4(color.xyz, 0.2);\r\n        }\r\n      }\r\n    }\r\n    if(vUv.y < 0.03)\r\n      gl_FragColor = finalColor;\r\n    else \r\n      gl_FragColor = vec4(finalColor.xyz, 0.08);\r\n  }\r\n`;\r\n\r\ninterface TimeAction {\r\n  time: number;\r\n}\r\n\r\nlet attackHandle: number,\r\n  bigMask: THREE.Mesh,\r\n  flyLine: FlyLine,\r\n  tweenMove: any,\r\n  requestAnimationId: number;\r\n\r\nconst setBigMask = () => {\r\n  const geometry = new THREE.SphereGeometry(\r\n    50,\r\n    36,\r\n    36,\r\n    0,\r\n    Math.PI * 2,\r\n    0,\r\n    (Math.PI / 180) * 90\r\n  );\r\n\r\n  const canvas = setTexture();\r\n\r\n  const texture = new THREE.CanvasTexture(canvas);\r\n  // texture.wrapS = THREE.RepeatWrapping;\r\n  // texture.wrapT = THREE.RepeatWrapping;\r\n  const material = new THREE.ShaderMaterial({\r\n    vertexShader: vs,\r\n    fragmentShader: fs,\r\n    uniforms: {\r\n      sphereTexture: {\r\n        value: texture,\r\n      },\r\n      spherePos1: {\r\n        // @ts-ignore\r\n        type: \"fv\",\r\n        value: new Array(30).fill(-1),\r\n      },\r\n      ring: {\r\n        value: 0.1,\r\n      },\r\n    },\r\n    transparent: true,\r\n    side: THREE.DoubleSide,\r\n  });\r\n  // console.log(material);\r\n\r\n  bigMask = new THREE.Mesh(geometry, material);\r\n  bigMask.position.set(0, 0, 0);\r\n  bigMask.layers.enable(bloomLayerNum);\r\n\r\n  return bigMask;\r\n};\r\n\r\nconst setTexture = () => {\r\n  const canvas = document.createElement(\"canvas\");\r\n  canvas.width = 128;\r\n  canvas.height = 128;\r\n  const gl = canvas.getContext(\"2d\");\r\n  const lingrad = gl!.createLinearGradient(0, 0, 0, 128);\r\n  lingrad.addColorStop(0, \"#FFF\");\r\n  lingrad.addColorStop(0.98, \"rgba(3,12,255,0.2)\");\r\n  lingrad.addColorStop(1, \"rgba(3,1,136,1)\");\r\n\r\n  gl!.fillStyle = lingrad;\r\n  gl!.fillRect(0, 0, 128, 128);\r\n\r\n  // document.body.append(canvas);\r\n  return canvas;\r\n};\r\n\r\nconst startAttack = (scene: THREE.Mesh) => {\r\n  if (attackHandle) clearInterval(attackHandle);\r\n  attackHandle = setInterval(() => {\r\n    createLine(scene);\r\n  }, 3000);\r\n};\r\n\r\nconst createLine = (scene: THREE.Mesh) => {\r\n  removeLine(scene);\r\n\r\n  const result = [];\r\n  const lines = [];\r\n  const colorData = [];\r\n  flyLine = new FlyLine(undefined, undefined, undefined, 1.0);\r\n  for (let i = 0; i < 10; i++) {\r\n    const tmp = getIntersect();\r\n    // console.log(tmp);\r\n    result.push(tmp.end.x);\r\n    result.push(tmp.end.y);\r\n    result.push(tmp.end.z);\r\n    const lineData = [tmp.start, tmp.end];\r\n    lines.push(lineData);\r\n    colorData.push(new THREE.Color(1, 0, 1));\r\n  }\r\n  flyLine.setParticles(lines, colorData);\r\n  for (let i = 0; i < flyLine.particles.length; i++) {\r\n    scene.add(flyLine.particles[i]);\r\n  }\r\n  flyLine.moveAction({ time: 0.0 }, { time: 1.0 }, 800);\r\n\r\n  updateMaterial(result);\r\n  moveAction({ time: 0 }, { time: 1.0 }, 1500);\r\n};\r\n\r\nconst removeLine = (scene: THREE.Mesh) => {\r\n  // @ts-ignore\r\n  bigMask.material.uniforms.spherePos1.value = new Array(30).fill(-1);\r\n  if (flyLine) flyLine.destroy(scene);\r\n};\r\n\r\nconst updateMaterial = (target: number[]) => {\r\n  // @ts-ignore\r\n  bigMask.material.uniforms.spherePos1.value = target;\r\n};\r\n\r\nconst getIntersect = () => {\r\n  const point1 = new THREE.Vector3(\r\n    Math.floor(Math.random() * (50 - -50 + 1)) + -50 + 30,\r\n    Math.floor(Math.random() * (50 - 0 + 1)) + 0 + 50,\r\n    Math.floor(Math.random() * (50 - -50 + 1)) + -50 + 30\r\n  );\r\n  const point2 = new THREE.Vector3(\r\n    Math.floor(Math.random() * (20 - -20 + 1)) + -20,\r\n    Math.floor(Math.random() * (20 - 0 + 1)) + 0,\r\n    Math.floor(Math.random() * (20 - -20 + 1)) + -20\r\n  );\r\n  const vec = point2.sub(point1).normalize();\r\n  const ray = new THREE.Ray(point1, vec);\r\n  const intersectPoint = new THREE.Vector3();\r\n  ray.intersectSphere(\r\n    new THREE.Sphere(new THREE.Vector3(0, 0, 0), 50),\r\n    intersectPoint\r\n  );\r\n  return { start: point1, end: intersectPoint };\r\n};\r\n\r\nconst moveAction = (\r\n  startLocation: TimeAction,\r\n  endLocation: TimeAction,\r\n  duration: number\r\n) => {\r\n  const updateAction = (time: number) => {\r\n    // @ts-ignore\r\n    bigMask.material.uniforms.ring.value = time;\r\n  };\r\n  tweenMove = new Tween(startLocation)\r\n    .to(endLocation, duration)\r\n    .easing(Easing.Linear.None)\r\n    .onUpdate(() => {\r\n      updateAction(startLocation.time);\r\n    })\r\n    .onStop(() => {\r\n      tweenMove = null;\r\n    })\r\n    .onComplete(() => {\r\n      tweenMove = null;\r\n    })\r\n    .repeat(Infinity)\r\n    .start();\r\n\r\n  const animate = (time: number) => {\r\n    if (tweenMove !== null) {\r\n      tweenMove.update(time);\r\n      requestAnimationId = requestAnimationFrame(animate);\r\n    }\r\n  };\r\n  animate(0);\r\n};\r\n\r\nconst bigMaskdestroy = (scene: THREE.Mesh) => {\r\n  if (requestAnimationId) cancelAnimationFrame(requestAnimationId);\r\n  if (attackHandle) clearInterval(attackHandle);\r\n  if (flyLine) flyLine.destroy(scene);\r\n  scene.remove(bigMask);\r\n  bigMask.geometry.dispose();\r\n  // @ts-ignore\r\n  bigMask.material.dispose();\r\n};\r\n\r\nexport { startAttack, bigMaskdestroy, setBigMask };\r\n","import * as THREE from \"three\";\r\n\r\nimport { bloomLayerNum } from \"@/utils/setbloom\";\r\nimport { FlyLine } from \"@/components/Earth/line\";\r\n\r\nconst sphereVs = `\r\n  varying vec2 vUv;\r\n  varying vec3 vPosition;\r\n  void main() {\r\n    vUv = uv;\r\n    vPosition = position;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n  }\r\n`;\r\n\r\nconst sphereFs = `\r\n  uniform sampler2D sphereTexture;\r\n  uniform vec3 pointPos[3];\r\n  uniform float ring;\r\n  varying vec2 vUv;\r\n  varying vec3 vPosition;\r\n  void main() {\r\n    vec3 color = vec4(texture2D(sphereTexture, vUv)).xyz;\r\n    vec4 finalColor = vec4(-1.0, -1.0, -1.0, -1.0);\r\n    for(int i=0; i<3; i++) {\r\n      if(pointPos[i].x == -1.0 && pointPos[i].y == -1.0 && pointPos[i].z == -1.0) {\r\n        finalColor = vec4(color, 0.2);\r\n      } else {\r\n        float dis = distance(vPosition, pointPos[i]);\r\n        if(dis < ring) {\r\n          float a = 1.0 - dis / ring * 0.6;\r\n          gl_FragColor = vec4(color, a);\r\n          return;\r\n        } else {\r\n          finalColor = vec4(color, 0.2);\r\n        }\r\n      }\r\n    }\r\n    gl_FragColor = finalColor;\r\n  }\r\n`;\r\n\r\nlet smallMask: THREE.Mesh, attackHandle: number, flyLine: FlyLine;\r\n\r\nconst setSmallMask = () => {\r\n  const geometry = new THREE.SphereGeometry(\r\n    25,\r\n    36,\r\n    36,\r\n    0,\r\n    Math.PI * 2,\r\n    0,\r\n    (Math.PI / 180) * 90\r\n  );\r\n\r\n  const png = require(\"@/assets/city/water.jpg\")\r\n  const texture = new THREE.TextureLoader().load(png);\r\n  const material = new THREE.ShaderMaterial({\r\n    vertexShader: sphereVs,\r\n    fragmentShader: sphereFs,\r\n    uniforms: {\r\n      sphereTexture: {\r\n        value: texture,\r\n      },\r\n      pointPos: {\r\n        // @ts-ignore\r\n        type: \"fv\",\r\n        value: new Array(9).fill(-1),\r\n      },\r\n      ring: {\r\n        value: 3.0,\r\n      },\r\n    },\r\n    transparent: true,\r\n    side: THREE.DoubleSide,\r\n  });\r\n\r\n  smallMask = new THREE.Mesh(geometry, material);\r\n  smallMask.position.set(0, 0, 0);\r\n  smallMask.layers.enable(0);\r\n\r\n  return smallMask;\r\n};\r\n\r\nconst createLine = (scene: THREE.Mesh) => {\r\n  removeLine(scene);\r\n\r\n  const result = [];\r\n  const lines = [];\r\n  const colorData = [];\r\n  for (let i = 0; i < 3; i++) {\r\n    const tmp = getIntersect();\r\n    // console.log(tmp);\r\n    result.push(tmp.end.x);\r\n    result.push(tmp.end.y);\r\n    result.push(tmp.end.z);\r\n    const lineData = [tmp.start, tmp.end];\r\n    lines.push(lineData);\r\n    colorData.push(new THREE.Color(0, 1, 1));\r\n  }\r\n  flyLine = new FlyLine(undefined, undefined, undefined, 0.8);\r\n  flyLine.setParticles(lines, colorData);\r\n  for (let i = 0; i < flyLine.particles.length; i++) {\r\n    scene.add(flyLine.particles[i]);\r\n  }\r\n  flyLine.moveAction({ time: 0.0 }, { time: 1.0 }, 1200);\r\n  updateMaterial(result);\r\n};\r\n\r\nconst updateMaterial = (target: number[]) => {\r\n  // @ts-ignore\r\n  smallMask.material.uniforms.pointPos.value = target;\r\n};\r\n\r\nconst getIntersect = () => {\r\n  const point1 = new THREE.Vector3(\r\n    Math.floor(Math.random() * (50 - -50 + 1)) + -50 + 30,\r\n    Math.floor(Math.random() * (50 - 0 + 1)) + 0 + 50,\r\n    Math.floor(Math.random() * (50 - -50 + 1)) + -50 + 30\r\n  );\r\n  const point2 = new THREE.Vector3(\r\n    Math.floor(Math.random() * (10 - -10 + 1)) + -10,\r\n    Math.floor(Math.random() * (10 - 0 + 1)) + 0,\r\n    Math.floor(Math.random() * (10 - -10 + 1)) + -10\r\n  );\r\n  const vec = point2.sub(point1).normalize();\r\n  const ray = new THREE.Ray(point1, vec);\r\n  const intersectPoint = new THREE.Vector3();\r\n  ray.intersectSphere(\r\n    new THREE.Sphere(new THREE.Vector3(0, 0, 0), 25),\r\n    intersectPoint\r\n  );\r\n  return { start: point1, end: intersectPoint };\r\n};\r\n\r\nconst removeLine = (scene: THREE.Mesh) => {\r\n  // @ts-ignore\r\n  smallMask.material.uniforms.pointPos.value = new Array(9).fill(-1);\r\n  if (flyLine) flyLine.destroy(scene);\r\n};\r\n\r\nconst startSmallAttack = (scene: THREE.Mesh) => {\r\n  attackHandle = setInterval(() => {\r\n    createLine(scene);\r\n  }, 3000);\r\n};\r\n\r\nconst smallMaskdestroy = (scene: THREE.Mesh) => {\r\n  if (attackHandle) clearInterval(attackHandle);\r\n  if (flyLine) flyLine.destroy(scene);\r\n  scene.remove(smallMask);\r\n  smallMask.geometry.dispose();\r\n  // @ts-ignore\r\n  smallMask.material.dispose();\r\n};\r\n\r\nexport { setSmallMask, smallMaskdestroy, startSmallAttack };\r\n","import * as THREE from \"three\";\r\nimport { EffectComposer } from \"three/examples/jsm/postprocessing/EffectComposer\";\r\n\r\nimport { BaseThree } from \"@/utils/basethree\";\r\nimport { bloomLayerNum, initBloom, render } from \"@/utils/setbloom\";\r\nimport {\r\n  startAttack,\r\n  bigMaskdestroy,\r\n  setBigMask,\r\n} from \"@/components/GongfangPage/bigmask\";\r\nimport {\r\n  setSmallMask,\r\n  smallMaskdestroy,\r\n  startSmallAttack,\r\n} from \"@/components/GongfangPage/smallmask\";\r\n\r\nlet gongfang: THREE.Mesh,\r\n  ambientLight: THREE.AmbientLight,\r\n  hemisLight: THREE.HemisphereLight,\r\n  baseThree: BaseThree,\r\n  composer: EffectComposer,\r\n  animateFrame: number;\r\n\r\nconst init = (domContainer: HTMLDivElement) => {\r\n  baseThree = new BaseThree(domContainer);\r\n  baseThree.camera.position.set(-10, 100, 120);\r\n  baseThree.setCameraPosition();\r\n\r\n  ambientLight = new THREE.AmbientLight(0x404040);\r\n  ambientLight.layers.enable(bloomLayerNum);\r\n  ambientLight.layers.enable(0);\r\n  baseThree.scene.add(ambientLight);\r\n\r\n  hemisLight = new THREE.HemisphereLight(0xffffff, 0x080820, 1);\r\n  hemisLight.position.set(0, 0, 10);\r\n  hemisLight.layers.enable(bloomLayerNum);\r\n  hemisLight.layers.enable(0);\r\n  baseThree.scene.add(hemisLight);\r\n\r\n  composer = initBloom(baseThree.scene, baseThree.camera, baseThree.renderer);\r\n\r\n  gongfang = new THREE.Mesh();\r\n  baseThree.scene.add(gongfang);\r\n\r\n  addSmallMask(gongfang);\r\n  addBigMask(gongfang);\r\n};\r\n\r\nconst animate = () => {\r\n  render(baseThree.scene, baseThree.camera, baseThree.renderer, composer);\r\n  baseThree.orbitControl.update();\r\n  animateFrame = requestAnimationFrame(animate);\r\n};\r\n\r\nconst addBigMask = (mesh: THREE.Mesh) => {\r\n  const bigMask = setBigMask();\r\n  mesh.add(bigMask);\r\n  startAttack(bigMask);\r\n};\r\n\r\nconst addSmallMask = (mesh: THREE.Mesh) => {\r\n  const smallMask = setSmallMask();\r\n  mesh.add(smallMask);\r\n  startSmallAttack(smallMask);\r\n};\r\n\r\nconst destroy = () => {\r\n  cancelAnimationFrame(animateFrame);\r\n  ambientLight.dispose();\r\n  hemisLight.dispose();\r\n  bigMaskdestroy(gongfang);\r\n  smallMaskdestroy(gongfang);\r\n  baseThree.destroy();\r\n};\r\n\r\nexport { init, animate, destroy, baseThree };\r\n","import { defineComponent as _defineComponent } from 'vue'\nimport { openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nimport { ref, onMounted, onBeforeUnmount, inject } from \"vue\";\r\nimport { init, animate, destroy, baseThree } from \"./glrender\";\r\nimport { btnData } from \"@/components/Layout/ToolBar/main\";\r\n\r\n\nexport default /*#__PURE__*/_defineComponent({\n  setup(__props) {\n\r\nconst setCurrentSceneState: any = inject(\"setCurrentSceneState\");\r\n\r\nconst gongfangContainer = ref();\r\n\r\nonMounted(async () => {\r\n  btnData.rotateBtn.isChecked = true;\r\n  init(gongfangContainer.value);\r\n  animate();\r\n  setCurrentSceneState(baseThree);\r\n  // console.log(currentScene.scene);\r\n  baseThree.startRotate();\r\n  btnData.rotateBtn.isChecked = true;\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n  destroy();\r\n});\r\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createElementBlock(\"div\", {\n    class: \"gongfang-container\",\n    ref_key: \"gongfangContainer\",\n    ref: gongfangContainer\n  }, null, 512))\n}\n}\n\n})","import script from \"./index.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./index.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./index.vue?vue&type=style&index=0&id=6449d9e2&lang=less&scoped=true\"\n\nimport exportComponent from \"/Users/wwwwwk/Desktop/items/3dself/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6449d9e2\"]])\n\nexport default __exports__","\r\nimport GongfangPage from \"@/components/GongfangPage/index.vue\";\r\nimport { inject } from \"vue\";\r\n\r\nexport default {\r\n  name: \"gongfang\",\r\n  components: { GongfangPage },\r\n  setup() {\r\n    const setToolbarState: any = inject(\"setToolbarState\");\r\n    setToolbarState({\r\n      routeControl: true,\r\n      rotateControl: true,\r\n      initControl: true,\r\n    });\r\n  },\r\n};\r\n","import { render } from \"./gongfang.vue?vue&type=template&id=3ce43c52&ts=true\"\nimport script from \"./gongfang.vue?vue&type=script&lang=ts\"\nexport * from \"./gongfang.vue?vue&type=script&lang=ts\"\n\nimport \"./gongfang.vue?vue&type=style&index=0&id=3ce43c52&lang=less\"\n\nimport exportComponent from \"/Users/wwwwwk/Desktop/items/3dself/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=6449d9e2&lang=less&scoped=true\""],"sourceRoot":""}